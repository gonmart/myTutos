<!DOCTYPE html>
<html>
<head>
    <title>Testing Grouping</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.TimeboxScopedApp",componentCls:"app",scopeType:"milestone",comboboxConfig:{hideLabel:!1,fieldLabel:"Milestone",labelAlign:"right"},myDefectStore:void 0,myGrid:void 0,onScopeChange:function(t){this._myStore(t)},_myFilters:function(t){return Ext.create("Rally.data.wsapi.Filter",{property:"Milestones.ObjectID",operator:"contains",value:t.getRecord()?t.getRecord().get("ObjectID"):null})},_myStore:function(t){var e=this._myFilters(t);this.myStore?(this.myStore.setFilter(e),this.myStore.load()):this.myStore=Ext.create("Rally.data.wsapi.Store",{model:"defect",autoLoad:!0,limit:1/0,filters:e,groupField:"Priority",context:{project:null,projectScopeDown:!0},fetch:["FormattedID","Name","State","ScheduleState","Priority","Severity","Project","Milestones"],listeners:{scope:this,load:this._onLoadLogic},sorters:[{property:"FormattedID",direction:"DESC"}]})},_onLoadLogic:function(t){var e=t.getGroups();_.forEach(e,function(t){var e=_.pluck(t.children,"raw");t.Submitted=_.chain(e).where({State:"Submitted"}).size().value(),t.Open=_.chain(e).where({State:"Open"}).size().value(),t.Resolved=_.chain(e).where({State:"Resolved"}).size().value(),t.Rejected=_.chain(e).where({State:"Rejected"}).size().value(),t.Closed=_.chain(e).where({State:"Closed"}).size().value(),t.total=e.length}),this._data=e,this._export&&this._export.destroy(),this._export=Ext.create("Ext.container.Container",{html:['<table id="dt-table" class="display compact" style="width:50%">',"<tfoot>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","</tfoot>","</table>"].join("")}),this._export.on("boxready",this._myGrid,this),this.add(this._export)},_myGrid:function(){this._dt=$("#dt-table").DataTable({data:this._data,dom:"rt",columns:[{title:"Name",data:"name",defaultContent:"",className:""},{title:"Submitted",data:"Submitted",defaultContent:"",className:"dt-center"},{title:"Open",data:"Open",defaultContent:"",className:"dt-center"},{title:"Resolved",data:"Resolved",defaultContent:"",className:"dt-center"},{title:"Rejected",data:"Rejected",defaultContent:"",className:"dt-center"},{title:"Closed",data:"Closed",defaultContent:"",className:"dt-center"},{title:"Total",data:"total",defaultContent:"",className:"dt-center"}],paging:!1,ordering:!1,info:!1,columnDefs:[{className:"dt-center",targets:"_all"}],footerCallback:function(t,e,a,o,i){var l=this.api(),n=l.column(0);l.data().count()>0&&$(n.footer()).html("<strong>Total</strong>"),l.columns([1,2,3,4,5,6]).every(function(){if(this.data().count()>0){var t=this.data().reduce(function(t,e){return t+e});$(this.footer()).html("<strong>"+t+"</strong>")}})}})}});

            Rally.launchApp('CustomApp', {
                name:"Testing Grouping",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
