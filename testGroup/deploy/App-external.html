<!DOCTYPE html>
<html>
<head>
    <title>Testing Grouping</title>

    <script type="text/javascript" src="https://rally1.rallydev.com/apps/2.1/sdk.js"></script>

    <script type="text/javascript">
        Rally.onReady(function () {
                Ext.define("CustomApp",{extend:"Rally.app.TimeboxScopedApp",componentCls:"app",scopeType:"milestone",comboboxConfig:{hideLabel:!1,fieldLabel:"Milestone",labelAlign:"right"},myDefectStore:void 0,myGrid:void 0,onScopeChange:function(e){this._myStore(e)},_myFilters:function(e){return Ext.create("Rally.data.wsapi.Filter",{property:"Milestones.ObjectID",operator:"contains",value:e.getRecord()?e.getRecord().get("ObjectID"):null})},_myStore:function(e){var t=this._myFilters(e);this.myStore?(this.myStore.setFilter(t),this.myStore.load()):this.myStore=Ext.create("Rally.data.wsapi.Store",{model:"defect",autoLoad:!0,limit:1/0,filters:t,groupField:"Project",getGroupString:function(e){return e.data.Project?e.data.Project.Name:"None"},context:{project:null,projectScopeDown:!0},fetch:["FormattedID","Name","State","ScheduleState","Priority","Severity","Project","Milestones"],listeners:{scope:this,load:this._onLoadLogic},sorters:[{property:"FormattedID",direction:"DESC"}]})},_onLoadLogic:function(e,t){var o=e.getGroups();_.forEach(o,function(e){var t=_.pluck(e.children,"raw");e.Submitted=_.chain(t).where({state:"Submitted"}).size().value(),e.Open=_.chain(t).where({state:"Open"}).size().value(),e.Resolved=_.chain(t).where({state:"Resolved"}).size().value(),e.Rejected=_.chain(t).where({state:"Rejected"}).size().value(),e.Closed=_.chain(t).where({state:"Closed"}).size().value(),e.total=t.length}),this._data=o,this._export&&this._export.destroy(),this._export=Ext.create("Ext.container.Container",{html:['<table id="dt-table" class="table table-bordered table-hover table-condensed">',"<tfoot>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","<th></th>","</tfoot>","</table>"].join("")}),this._export.on("boxready",this._myGrid,this),this.add(this._export)},_myGrid:function(){}});

            Rally.launchApp('CustomApp', {
                name:"Testing Grouping",
                parentRepos:"",
                version:"0.1.1"
            });

        });
    </script>


    <style type="text/css">
        
    </style>
</head>
<body>
</body>
</html>
